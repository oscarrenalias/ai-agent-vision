import{s as je,n as ie,d as c,a as W,C as me,i as U,b as s,l as f,c as v,e as D,g as A,f as M,h,j as V,t as B,r as Be,q as ge,m as ze,o as X,k as Ye,p as be,E as ye,w as Je,x as ke,y as Ce}from"../chunks/BYDQNPMj.js";import{S as Oe,i as Ue,t as oe,a as se,c as Ee,d as fe,m as de,e as _e,b as ve,g as De}from"../chunks/DGRzr_AR.js";import{c as qe,s as ue,e as Ie,i as Ge}from"../chunks/BhXfAO3M.js";import{C as Me}from"../chunks/C4B192fd.js";function Te(a){let e,t;return{c(){e=h("p"),t=B(a[2]),this.h()},l(l){e=v(l,"P",{class:!0});var o=D(e);t=M(o,a[2]),o.forEach(c),this.h()},h(){f(e,"class","svelte-usy1ao")},m(l,o){U(l,e,o),s(e,t)},p(l,o){o&4&&W(t,l[2])},d(l){l&&c(e)}}}function Qe(a){let e,t,l,o,r,n,u,_,m,p,g,i,d,b,k=a[2]&&Te(a);return{c(){e=h("div"),t=h("div"),l=h("div"),o=V(),r=h("h3"),n=B(a[1]),u=V(),k&&k.c(),_=V(),m=h("div"),p=h("div"),g=V(),i=h("div"),d=B(a[0]),b=B("%"),this.h()},l(w){e=v(w,"DIV",{class:!0});var S=D(e);t=v(S,"DIV",{class:!0});var N=D(t);l=v(N,"DIV",{class:!0}),D(l).forEach(c),o=A(N),r=v(N,"H3",{class:!0});var L=D(r);n=M(L,a[1]),L.forEach(c),u=A(N),k&&k.l(N),_=A(N),m=v(N,"DIV",{class:!0});var q=D(m);p=v(q,"DIV",{class:!0,style:!0}),D(p).forEach(c),q.forEach(c),g=A(N),i=v(N,"DIV",{class:!0});var Y=D(i);d=M(Y,a[0]),b=M(Y,"%"),Y.forEach(c),N.forEach(c),S.forEach(c),this.h()},h(){f(l,"class","spinner svelte-usy1ao"),f(r,"class","svelte-usy1ao"),f(p,"class","progress-bar svelte-usy1ao"),me(p,"width",a[0]+"%"),f(m,"class","progress-container svelte-usy1ao"),f(i,"class","progress-text svelte-usy1ao"),f(t,"class","processing-container svelte-usy1ao"),f(e,"class","processing-overlay svelte-usy1ao")},m(w,S){U(w,e,S),s(e,t),s(t,l),s(t,o),s(t,r),s(r,n),s(t,u),k&&k.m(t,null),s(t,_),s(t,m),s(m,p),s(t,g),s(t,i),s(i,d),s(i,b)},p(w,[S]){S&2&&W(n,w[1]),w[2]?k?k.p(w,S):(k=Te(w),k.c(),k.m(t,_)):k&&(k.d(1),k=null),S&1&&me(p,"width",w[0]+"%"),S&1&&W(d,w[0])},i:ie,o:ie,d(w){w&&c(e),k&&k.d()}}}function We(a,e,t){let{progress:l=0}=e,{message:o="Processing..."}=e,{submessage:r=""}=e;return a.$$set=n=>{"progress"in n&&t(0,l=n.progress),"message"in n&&t(1,o=n.message),"submessage"in n&&t(2,r=n.submessage)},[l,o,r]}class Ke extends Oe{constructor(e){super(),Ue(this,e,We,Qe,je,{progress:0,message:1,submessage:2})}}function we(a,e,t){const l=a.slice();return l[19]=e[t],l}function Xe(a){let e,t='<span class="icon svelte-rgc7on">ðŸ“·</span> <span>Click to select a receipt image</span>';return{c(){e=h("div"),e.innerHTML=t,this.h()},l(l){e=v(l,"DIV",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-cu4pff"&&(e.innerHTML=t),this.h()},h(){f(e,"class","upload-placeholder svelte-rgc7on")},m(l,o){U(l,e,o)},p:ie,d(l){l&&c(e)}}}function Ze(a){let e,t;return{c(){e=h("img"),this.h()},l(l){e=v(l,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){ye(e.src,t=a[2])||f(e,"src",t),f(e,"alt","Receipt preview"),f(e,"class","preview-image svelte-rgc7on")},m(l,o){U(l,e,o)},p(l,o){o&4&&!ye(e.src,t=l[2])&&f(e,"src",t)},d(l){l&&c(e)}}}function Ae(a){let e,t;return{c(){e=h("div"),t=B(a[5]),this.h()},l(l){e=v(l,"DIV",{class:!0});var o=D(e);t=M(o,a[5]),o.forEach(c),this.h()},h(){f(e,"class","error-message svelte-rgc7on")},m(l,o){U(l,e,o),s(e,t)},p(l,o){o&32&&W(t,l[5])},d(l){l&&c(e)}}}function Ve(a){let e,t="Receipt processed successfully, but no data was returned.";return{c(){e=h("div"),e.textContent=t,this.h()},l(l){e=v(l,"DIV",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-uc6zw3"&&(e.textContent=t),this.h()},h(){f(e,"class","success-message svelte-rgc7on")},m(l,o){U(l,e,o)},d(l){l&&c(e)}}}function Re(a){let e,t=`Receipt processed successfully!
          <a href="/receipts/history" class="view-history-link svelte-rgc7on">View Receipt History</a>`;return{c(){e=h("div"),e.innerHTML=t,this.h()},l(l){e=v(l,"DIV",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-1hqp39h"&&(e.innerHTML=t),this.h()},h(){f(e,"class","success-message svelte-rgc7on")},m(l,o){U(l,e,o)},d(l){l&&c(e)}}}function Ne(a){let e,t;return e=new Ke({props:{progress:a[8],message:"Processing your receipt...",submessage:"This may take 2-3 minutes to complete. Please don't refresh the page."}}),{c(){ve(e.$$.fragment)},l(l){_e(e.$$.fragment,l)},m(l,o){de(e,l,o),t=!0},p(l,o){const r={};o&256&&(r.progress=l[8]),e.$set(r)},i(l){t||(se(e.$$.fragment,l),t=!0)},o(l){oe(e.$$.fragment,l),t=!1},d(l){fe(e,l)}}}function Pe(a){let e,t,l="Receipt Analysis Results",o,r,n,u=a[0].receipt_data&&Le(a),_=a[0].items&&a[0].items.length>0&&He(a);function m(i,d){return i[0].items&&i[0].items.length>0?xe:$e}let p=m(a),g=p(a);return{c(){e=h("div"),t=h("h2"),t.textContent=l,o=V(),u&&u.c(),r=V(),_&&_.c(),n=V(),g.c(),this.h()},l(i){e=v(i,"DIV",{class:!0});var d=D(e);t=v(d,"H2",{class:!0,"data-svelte-h":!0}),X(t)!=="svelte-1v28t3u"&&(t.textContent=l),o=A(d),u&&u.l(d),r=A(d),_&&_.l(d),n=A(d),g.l(d),d.forEach(c),this.h()},h(){f(t,"class","svelte-rgc7on"),f(e,"class","receipt-results svelte-rgc7on")},m(i,d){U(i,e,d),s(e,t),s(e,o),u&&u.m(e,null),s(e,r),_&&_.m(e,null),s(e,n),g.m(e,null)},p(i,d){i[0].receipt_data?u?u.p(i,d):(u=Le(i),u.c(),u.m(e,r)):u&&(u.d(1),u=null),i[0].items&&i[0].items.length>0?_?_.p(i,d):(_=He(i),_.c(),_.m(e,n)):_&&(_.d(1),_=null),p===(p=m(i))&&g?g.p(i,d):(g.d(1),g=p(i),g&&(g.c(),g.m(e,null)))},d(i){i&&c(e),u&&u.d(),_&&_.d(),g.d()}}}function Le(a){let e,t,l="Receipt Summary",o,r,n,u,_,m="Date",p,g,i=(a[0].receipt_data.date||"N/A")+"",d,b,k,w,S="Place",N,L,q=(a[0].receipt_data.place||"N/A")+"",Y,R,T,I,j="Total",x,Q,J=a[0].receipt_data.total?`â‚¬${a[0].receipt_data.total.toFixed(2)}`:"N/A",C,y,P,F,z="Total Savings",H,O,Z=(a[0].receipt_data.total_savings||"N/A")+"",$;return{c(){e=h("div"),t=h("h3"),t.textContent=l,o=V(),r=h("table"),n=h("tbody"),u=h("tr"),_=h("th"),_.textContent=m,p=V(),g=h("td"),d=B(i),b=V(),k=h("tr"),w=h("th"),w.textContent=S,N=V(),L=h("td"),Y=B(q),R=V(),T=h("tr"),I=h("th"),I.textContent=j,x=V(),Q=h("td"),C=B(J),y=V(),P=h("tr"),F=h("th"),F.textContent=z,H=V(),O=h("td"),$=B(Z),this.h()},l(ee){e=v(ee,"DIV",{class:!0});var E=D(e);t=v(E,"H3",{class:!0,"data-svelte-h":!0}),X(t)!=="svelte-1cqlgwa"&&(t.textContent=l),o=A(E),r=v(E,"TABLE",{class:!0});var K=D(r);n=v(K,"TBODY",{});var G=D(n);u=v(G,"TR",{class:!0});var le=D(u);_=v(le,"TH",{class:!0,"data-svelte-h":!0}),X(_)!=="svelte-1vf788i"&&(_.textContent=m),p=A(le),g=v(le,"TD",{class:!0});var ae=D(g);d=M(ae,i),ae.forEach(c),le.forEach(c),b=A(G),k=v(G,"TR",{class:!0});var re=D(k);w=v(re,"TH",{class:!0,"data-svelte-h":!0}),X(w)!=="svelte-cjzgdb"&&(w.textContent=S),N=A(re),L=v(re,"TD",{class:!0});var te=D(L);Y=M(te,q),te.forEach(c),re.forEach(c),R=A(G),T=v(G,"TR",{class:!0});var ne=D(T);I=v(ne,"TH",{class:!0,"data-svelte-h":!0}),X(I)!=="svelte-3jponc"&&(I.textContent=j),x=A(ne),Q=v(ne,"TD",{class:!0});var he=D(Q);C=M(he,J),he.forEach(c),ne.forEach(c),y=A(G),P=v(G,"TR",{class:!0});var ce=D(P);F=v(ce,"TH",{class:!0,"data-svelte-h":!0}),X(F)!=="svelte-lo4fxt"&&(F.textContent=z),H=A(ce),O=v(ce,"TD",{class:!0});var pe=D(O);$=M(pe,Z),pe.forEach(c),ce.forEach(c),G.forEach(c),K.forEach(c),E.forEach(c),this.h()},h(){f(t,"class","svelte-rgc7on"),f(_,"class","svelte-rgc7on"),f(g,"class","svelte-rgc7on"),f(u,"class","svelte-rgc7on"),f(w,"class","svelte-rgc7on"),f(L,"class","svelte-rgc7on"),f(k,"class","svelte-rgc7on"),f(I,"class","svelte-rgc7on"),f(Q,"class","svelte-rgc7on"),f(T,"class","svelte-rgc7on"),f(F,"class","svelte-rgc7on"),f(O,"class","svelte-rgc7on"),f(P,"class","svelte-rgc7on"),f(r,"class","svelte-rgc7on"),f(e,"class","receipt-summary")},m(ee,E){U(ee,e,E),s(e,t),s(e,o),s(e,r),s(r,n),s(n,u),s(u,_),s(u,p),s(u,g),s(g,d),s(n,b),s(n,k),s(k,w),s(k,N),s(k,L),s(L,Y),s(n,R),s(n,T),s(T,I),s(T,x),s(T,Q),s(Q,C),s(n,y),s(n,P),s(P,F),s(P,H),s(P,O),s(O,$)},p(ee,E){E&1&&i!==(i=(ee[0].receipt_data.date||"N/A")+"")&&W(d,i),E&1&&q!==(q=(ee[0].receipt_data.place||"N/A")+"")&&W(Y,q),E&1&&J!==(J=ee[0].receipt_data.total?`â‚¬${ee[0].receipt_data.total.toFixed(2)}`:"N/A")&&W(C,J),E&1&&Z!==(Z=(ee[0].receipt_data.total_savings||"N/A")+"")&&W($,Z)},d(ee){ee&&c(e)}}}function He(a){let e,t,l="Loyalty Discount Summary",o,r,n,u,_,m,p,g="Items with Discounts",i,d,b,k,w=a[6].toFixed(2)+"",S,N,L,q="Total Savings",Y,R,T,I=a[7]>0?`â‚¬${(a[6]/a[7]).toFixed(2)}`:"â‚¬0.00",j,x,Q,J="Average Discount per Item";return{c(){e=h("div"),t=h("h3"),t.textContent=l,o=V(),r=h("div"),n=h("div"),u=h("div"),_=B(a[7]),m=V(),p=h("div"),p.textContent=g,i=V(),d=h("div"),b=h("div"),k=B("â‚¬"),S=B(w),N=V(),L=h("div"),L.textContent=q,Y=V(),R=h("div"),T=h("div"),j=B(I),x=V(),Q=h("div"),Q.textContent=J,this.h()},l(C){e=v(C,"DIV",{class:!0});var y=D(e);t=v(y,"H3",{class:!0,"data-svelte-h":!0}),X(t)!=="svelte-1cw25gd"&&(t.textContent=l),o=A(y),r=v(y,"DIV",{class:!0});var P=D(r);n=v(P,"DIV",{class:!0});var F=D(n);u=v(F,"DIV",{class:!0});var z=D(u);_=M(z,a[7]),z.forEach(c),m=A(F),p=v(F,"DIV",{class:!0,"data-svelte-h":!0}),X(p)!=="svelte-ci553k"&&(p.textContent=g),F.forEach(c),i=A(P),d=v(P,"DIV",{class:!0});var H=D(d);b=v(H,"DIV",{class:!0});var O=D(b);k=M(O,"â‚¬"),S=M(O,w),O.forEach(c),N=A(H),L=v(H,"DIV",{class:!0,"data-svelte-h":!0}),X(L)!=="svelte-13gevvv"&&(L.textContent=q),H.forEach(c),Y=A(P),R=v(P,"DIV",{class:!0});var Z=D(R);T=v(Z,"DIV",{class:!0});var $=D(T);j=M($,I),$.forEach(c),x=A(Z),Q=v(Z,"DIV",{class:!0,"data-svelte-h":!0}),X(Q)!=="svelte-x18kue"&&(Q.textContent=J),Z.forEach(c),P.forEach(c),y.forEach(c),this.h()},h(){f(t,"class","svelte-rgc7on"),f(u,"class","summary-value svelte-rgc7on"),f(p,"class","summary-label svelte-rgc7on"),f(n,"class","summary-card svelte-rgc7on"),f(b,"class","summary-value svelte-rgc7on"),f(L,"class","summary-label svelte-rgc7on"),f(d,"class","summary-card highlight svelte-rgc7on"),f(T,"class","summary-value svelte-rgc7on"),f(Q,"class","summary-label svelte-rgc7on"),f(R,"class","summary-card svelte-rgc7on"),f(r,"class","summary-cards svelte-rgc7on"),f(e,"class","loyalty-summary svelte-rgc7on")},m(C,y){U(C,e,y),s(e,t),s(e,o),s(e,r),s(r,n),s(n,u),s(u,_),s(n,m),s(n,p),s(r,i),s(r,d),s(d,b),s(b,k),s(b,S),s(d,N),s(d,L),s(r,Y),s(r,R),s(R,T),s(T,j),s(R,x),s(R,Q)},p(C,y){y&128&&W(_,C[7]),y&64&&w!==(w=C[6].toFixed(2)+"")&&W(S,w),y&192&&I!==(I=C[7]>0?`â‚¬${(C[6]/C[7]).toFixed(2)}`:"â‚¬0.00")&&W(j,I)},d(C){C&&c(e)}}}function $e(a){let e,t="No items found in the receipt.";return{c(){e=h("p"),e.textContent=t},l(l){e=v(l,"P",{"data-svelte-h":!0}),X(e)!=="svelte-7gs42n"&&(e.textContent=t)},m(l,o){U(l,e,o)},p:ie,d(l){l&&c(e)}}}function xe(a){let e,t,l="Receipt Items",o,r,n,u='<tr class="svelte-rgc7on"><th class="svelte-rgc7on">Item</th> <th class="svelte-rgc7on">Quantity</th> <th class="svelte-rgc7on">Unit Price</th> <th class="svelte-rgc7on">Total Price</th> <th class="svelte-rgc7on">Loyalty Discount</th> <th class="svelte-rgc7on">Category</th></tr>',_,m,p=Ie(a[0].items),g=[];for(let i=0;i<p.length;i+=1)g[i]=Se(we(a,p,i));return{c(){e=h("div"),t=h("h3"),t.textContent=l,o=V(),r=h("table"),n=h("thead"),n.innerHTML=u,_=V(),m=h("tbody");for(let i=0;i<g.length;i+=1)g[i].c();this.h()},l(i){e=v(i,"DIV",{class:!0});var d=D(e);t=v(d,"H3",{class:!0,"data-svelte-h":!0}),X(t)!=="svelte-v4hn3y"&&(t.textContent=l),o=A(d),r=v(d,"TABLE",{class:!0});var b=D(r);n=v(b,"THEAD",{"data-svelte-h":!0}),X(n)!=="svelte-1su8k8"&&(n.innerHTML=u),_=A(b),m=v(b,"TBODY",{});var k=D(m);for(let w=0;w<g.length;w+=1)g[w].l(k);k.forEach(c),b.forEach(c),d.forEach(c),this.h()},h(){f(t,"class","svelte-rgc7on"),f(r,"class","svelte-rgc7on"),f(e,"class","receipt-items")},m(i,d){U(i,e,d),s(e,t),s(e,o),s(e,r),s(r,n),s(r,_),s(r,m);for(let b=0;b<g.length;b+=1)g[b]&&g[b].m(m,null)},p(i,d){if(d&1){p=Ie(i[0].items);let b;for(b=0;b<p.length;b+=1){const k=we(i,p,b);g[b]?g[b].p(k,d):(g[b]=Se(k),g[b].c(),g[b].m(m,null))}for(;b<g.length;b+=1)g[b].d(1);g.length=p.length}},d(i){i&&c(e),Je(g,i)}}}function et(a){let e;return{c(){e=B("-")},l(t){e=M(t,"-")},m(t,l){U(t,e,l)},p:ie,d(t){t&&c(e)}}}function tt(a){let e,t="Yes",l,o,r=a[19].loyalty_discount&&Fe(a);return{c(){e=h("span"),e.textContent=t,l=V(),r&&r.c(),o=Ce(),this.h()},l(n){e=v(n,"SPAN",{class:!0,"data-svelte-h":!0}),X(e)!=="svelte-120ladd"&&(e.textContent=t),l=A(n),r&&r.l(n),o=Ce(),this.h()},h(){f(e,"class","discount-badge svelte-rgc7on")},m(n,u){U(n,e,u),U(n,l,u),r&&r.m(n,u),U(n,o,u)},p(n,u){n[19].loyalty_discount?r?r.p(n,u):(r=Fe(n),r.c(),r.m(o.parentNode,o)):r&&(r.d(1),r=null)},d(n){n&&(c(e),c(l),c(o)),r&&r.d(n)}}}function Fe(a){let e,t,l=a[19].loyalty_discount.toFixed(2)+"",o;return{c(){e=h("span"),t=B("â‚¬"),o=B(l),this.h()},l(r){e=v(r,"SPAN",{class:!0});var n=D(e);t=M(n,"â‚¬"),o=M(n,l),n.forEach(c),this.h()},h(){f(e,"class","discount-amount svelte-rgc7on")},m(r,n){U(r,e,n),s(e,t),s(e,o)},p(r,n){n&1&&l!==(l=r[19].loyalty_discount.toFixed(2)+"")&&W(o,l)},d(r){r&&c(e)}}}function lt(a){let e;return{c(){e=B("N/A")},l(t){e=M(t,"N/A")},m(t,l){U(t,e,l)},p:ie,d(t){t&&c(e)}}}function st(a){let e=(a[19].item_category.level_1||"")+"",t,l,o=a[19].item_category.level_2?`> ${a[19].item_category.level_2}`:"",r,n,u=a[19].item_category.level_3?`> ${a[19].item_category.level_3}`:"",_;return{c(){t=B(e),l=V(),r=B(o),n=V(),_=B(u)},l(m){t=M(m,e),l=A(m),r=M(m,o),n=A(m),_=M(m,u)},m(m,p){U(m,t,p),U(m,l,p),U(m,r,p),U(m,n,p),U(m,_,p)},p(m,p){p&1&&e!==(e=(m[19].item_category.level_1||"")+"")&&W(t,e),p&1&&o!==(o=m[19].item_category.level_2?`> ${m[19].item_category.level_2}`:"")&&W(r,o),p&1&&u!==(u=m[19].item_category.level_3?`> ${m[19].item_category.level_3}`:"")&&W(_,u)},d(m){m&&(c(t),c(l),c(r),c(n),c(_))}}}function Se(a){let e,t,l=(a[19].name_en||a[19].name_fi||"N/A")+"",o,r,n,u=a[19].quantity?`${a[19].quantity} ${a[19].unit_of_measure||""}`:"N/A",_,m,p,g=a[19].unit_price?`â‚¬${a[19].unit_price.toFixed(2)}`:"N/A",i,d,b,k=a[19].total_price?`â‚¬${a[19].total_price.toFixed(2)}`:"N/A",w,S,N,L,q,Y,R;function T(C,y){return C[19].has_loyalty_discount?tt:et}let I=T(a),j=I(a);function x(C,y){return C[19].item_category?st:lt}let Q=x(a),J=Q(a);return{c(){e=h("tr"),t=h("td"),o=B(l),r=V(),n=h("td"),_=B(u),m=V(),p=h("td"),i=B(g),d=V(),b=h("td"),w=B(k),S=V(),N=h("td"),j.c(),L=V(),q=h("td"),J.c(),Y=V(),this.h()},l(C){e=v(C,"TR",{class:!0});var y=D(e);t=v(y,"TD",{class:!0});var P=D(t);o=M(P,l),P.forEach(c),r=A(y),n=v(y,"TD",{class:!0});var F=D(n);_=M(F,u),F.forEach(c),m=A(y),p=v(y,"TD",{class:!0});var z=D(p);i=M(z,g),z.forEach(c),d=A(y),b=v(y,"TD",{class:!0});var H=D(b);w=M(H,k),H.forEach(c),S=A(y),N=v(y,"TD",{class:!0});var O=D(N);j.l(O),O.forEach(c),L=A(y),q=v(y,"TD",{class:!0});var Z=D(q);J.l(Z),Z.forEach(c),Y=A(y),y.forEach(c),this.h()},h(){f(t,"class","svelte-rgc7on"),f(n,"class","svelte-rgc7on"),f(p,"class","svelte-rgc7on"),f(b,"class","svelte-rgc7on"),f(N,"class","svelte-rgc7on"),f(q,"class","svelte-rgc7on"),f(e,"class",R=ke(a[19].has_loyalty_discount?"has-discount":"")+" svelte-rgc7on")},m(C,y){U(C,e,y),s(e,t),s(t,o),s(e,r),s(e,n),s(n,_),s(e,m),s(e,p),s(p,i),s(e,d),s(e,b),s(b,w),s(e,S),s(e,N),j.m(N,null),s(e,L),s(e,q),J.m(q,null),s(e,Y)},p(C,y){y&1&&l!==(l=(C[19].name_en||C[19].name_fi||"N/A")+"")&&W(o,l),y&1&&u!==(u=C[19].quantity?`${C[19].quantity} ${C[19].unit_of_measure||""}`:"N/A")&&W(_,u),y&1&&g!==(g=C[19].unit_price?`â‚¬${C[19].unit_price.toFixed(2)}`:"N/A")&&W(i,g),y&1&&k!==(k=C[19].total_price?`â‚¬${C[19].total_price.toFixed(2)}`:"N/A")&&W(w,k),I===(I=T(C))&&j?j.p(C,y):(j.d(1),j=I(C),j&&(j.c(),j.m(N,null))),Q===(Q=x(C))&&J?J.p(C,y):(J.d(1),J=Q(C),J&&(J.c(),J.m(q,null))),y&1&&R!==(R=ke(C[19].has_loyalty_discount?"has-discount":"")+" svelte-rgc7on")&&f(e,"class",R)},d(C){C&&c(e),j.d(),J.d()}}}function at(a){let e,t;return e=new Me({props:{isOpen:a[9]}}),e.$on("close",qe),{c(){ve(e.$$.fragment)},l(l){_e(e.$$.fragment,l)},m(l,o){de(e,l,o),t=!0},p(l,o){const r={};o&512&&(r.isOpen=l[9]),e.$set(r)},i(l){t||(se(e.$$.fragment,l),t=!0)},o(l){oe(e.$$.fragment,l),t=!1},d(l){fe(e,l)}}}function rt(a){let e,t;return e=new Me({props:{isOpen:a[9],receiptData:a[0]}}),e.$on("close",qe),{c(){ve(e.$$.fragment)},l(l){_e(e.$$.fragment,l)},m(l,o){de(e,l,o),t=!0},p(l,o){const r={};o&512&&(r.isOpen=l[9]),o&1&&(r.receiptData=l[0]),e.$set(r)},i(l){t||(se(e.$$.fragment,l),t=!0)},o(l){oe(e.$$.fragment,l),t=!1},d(l){fe(e,l)}}}function nt(a){let e,t,l,o="Upload Receipt",r,n,u,_,m,p,g,i,d,b=a[3]?"Processing...":"Analyze Receipt",k,w,S,N,L,q,Y,R,T,I,j,x,Q;function J(E,K){return E[2]?Ze:Xe}let C=J(a),y=C(a),P=a[5]&&Ae(a),F=a[4]&&!a[0]&&Ve(),z=a[0]&&Re(),H=a[3]&&Ne(a),O=a[0]&&Pe(a);const Z=[rt,at],$=[];function ee(E,K){return E[0]?0:1}return T=ee(a),I=$[T]=Z[T](a),{c(){e=V(),t=h("div"),l=h("h1"),l.textContent=o,r=V(),n=h("div"),u=h("div"),_=h("label"),y.c(),m=V(),p=h("input"),g=V(),i=h("div"),d=h("button"),k=B(b),S=V(),P&&P.c(),N=V(),F&&F.c(),L=V(),z&&z.c(),q=V(),H&&H.c(),Y=V(),O&&O.c(),R=V(),I.c(),this.h()},l(E){ze("svelte-m2x57s",document.head).forEach(c),e=A(E),t=v(E,"DIV",{class:!0});var G=D(t);l=v(G,"H1",{class:!0,"data-svelte-h":!0}),X(l)!=="svelte-1mspa6t"&&(l.textContent=o),r=A(G),n=v(G,"DIV",{class:!0});var le=D(n);u=v(le,"DIV",{class:!0});var ae=D(u);_=v(ae,"LABEL",{for:!0,class:!0});var re=D(_);y.l(re),re.forEach(c),m=A(ae),p=v(ae,"INPUT",{type:!0,id:!0,accept:!0,class:!0}),ae.forEach(c),g=A(le),i=v(le,"DIV",{class:!0});var te=D(i);d=v(te,"BUTTON",{class:!0});var ne=D(d);k=M(ne,b),ne.forEach(c),S=A(te),P&&P.l(te),N=A(te),F&&F.l(te),L=A(te),z&&z.l(te),te.forEach(c),le.forEach(c),q=A(G),H&&H.l(G),Y=A(G),O&&O.l(G),R=A(G),I.l(G),G.forEach(c),this.h()},h(){document.title="AI Agent Vision - Receipt Upload",f(l,"class","svelte-rgc7on"),f(_,"for","receipt-upload"),f(_,"class","upload-label svelte-rgc7on"),f(p,"type","file"),f(p,"id","receipt-upload"),f(p,"accept","image/*"),f(p,"class","file-input svelte-rgc7on"),f(u,"class","upload-area svelte-rgc7on"),d.disabled=w=a[3]||!a[1],f(d,"class","submit-button svelte-rgc7on"),f(i,"class","controls svelte-rgc7on"),f(n,"class","upload-container svelte-rgc7on"),f(t,"class","receipt-upload svelte-rgc7on")},m(E,K){U(E,e,K),U(E,t,K),s(t,l),s(t,r),s(t,n),s(n,u),s(u,_),y.m(_,null),s(u,m),s(u,p),s(n,g),s(n,i),s(i,d),s(d,k),s(i,S),P&&P.m(i,null),s(i,N),F&&F.m(i,null),s(i,L),z&&z.m(i,null),s(t,q),H&&H.m(t,null),s(t,Y),O&&O.m(t,null),s(t,R),$[T].m(t,null),j=!0,x||(Q=[ge(p,"change",a[10]),ge(d,"click",a[11])],x=!0)},p(E,[K]){C===(C=J(E))&&y?y.p(E,K):(y.d(1),y=C(E),y&&(y.c(),y.m(_,null))),(!j||K&8)&&b!==(b=E[3]?"Processing...":"Analyze Receipt")&&W(k,b),(!j||K&10&&w!==(w=E[3]||!E[1]))&&(d.disabled=w),E[5]?P?P.p(E,K):(P=Ae(E),P.c(),P.m(i,N)):P&&(P.d(1),P=null),E[4]&&!E[0]?F||(F=Ve(),F.c(),F.m(i,L)):F&&(F.d(1),F=null),E[0]?z||(z=Re(),z.c(),z.m(i,null)):z&&(z.d(1),z=null),E[3]?H?(H.p(E,K),K&8&&se(H,1)):(H=Ne(E),H.c(),se(H,1),H.m(t,Y)):H&&(De(),oe(H,1,1,()=>{H=null}),Ee()),E[0]?O?O.p(E,K):(O=Pe(E),O.c(),O.m(t,R)):O&&(O.d(1),O=null);let G=T;T=ee(E),T===G?$[T].p(E,K):(De(),oe($[G],1,1,()=>{$[G]=null}),Ee(),I=$[T],I?I.p(E,K):(I=$[T]=Z[T](E),I.c()),se(I,1),I.m(t,null))},i(E){j||(se(H),se(I),j=!0)},o(E){oe(H),oe(I),j=!1},d(E){E&&(c(e),c(t)),y.d(),P&&P.d(),F&&F.d(),z&&z.d(),H&&H.d(),O&&O.d(),$[T].d(),x=!1,Be(Q)}}}function ot(a,e,t){let l;Ye(a,Ge,R=>t(9,l=R));let o,r="",n=!1,u=null,_=null,m=null,p=0,g=0,i=25,d;function b(R){const T=R.target.files[0];T&&(t(1,o=T),t(2,r=URL.createObjectURL(T)),t(4,u=null),t(0,m=null),t(5,_=null),t(6,p=0),t(7,g=0),ue(null))}function k(R){let T=0,I=0;R&&R.length>0&&R.forEach(j=>{j.has_loyalty_discount&&j.loyalty_discount&&(T+=parseFloat(j.loyalty_discount),I++)}),t(6,p=T),t(7,g=I)}function w(){t(8,i=10),d&&clearInterval(d),d=setInterval(()=>{i<40&&t(8,i+=10)},5e3)}function S(){d&&(clearInterval(d),d=null),t(8,i=100)}let N=null,L=null;async function q(){if(!o){t(5,_="Please select a file first");return}t(5,_=null),t(3,n=!0),t(0,m=null),N=null,w();try{const R=new FormData;R.append("file",o);const T=await fetch("/api/process",{method:"POST",body:R}),I=await T.json();T.ok&&I.job_id?(N=I.job_id,console.log(`Job started with ID: ${N}`),Y(N)):(t(5,_=I.message||"Failed to start receipt processing"),t(3,n=!1),S())}catch(R){t(5,_="Error uploading file: "+(R instanceof Error?R.message:String(R))),t(3,n=!1),S()}}function Y(R){L&&clearInterval(L),L=setInterval(async()=>{try{const I=await(await fetch(`/api/jobs/${R}`)).json();console.log("Job status:",I),I.status==="completed"?(clearInterval(L),t(3,n=!1),S(),t(0,m=I.result),k(m.items),ue(m),t(4,u={status:"success"})):I.status==="failed"?(clearInterval(L),t(3,n=!1),S(),t(5,_=I.error||"Receipt processing failed")):I.status==="processing"&&t(8,i=50)}catch(T){console.error("Error polling job status:",T)}},5e3)}return be(()=>()=>{L&&clearInterval(L),r&&URL.revokeObjectURL(r),d&&clearInterval(d)}),be(()=>()=>{r&&URL.revokeObjectURL(r),d&&clearInterval(d)}),a.$$.update=()=>{a.$$.dirty&1&&m&&ue(m)},[m,o,r,n,u,_,p,g,i,l,b,q]}class dt extends Oe{constructor(e){super(),Ue(this,e,ot,nt,je,{})}}export{dt as component};
