# Running the app as a service in Raspberry Pi OS

# Deploying the application

Download the latest release of the .deb package from the repository: https://github.com/oscarrenalias/ai-agent-vision/releases

```bash
wget https://github.com/oscarrenalias/ai-agent-vision/releases/download/release-0.1.0-ci20250602172918.086f521/ai-agent-vision_0.1.0.ci20250602172918.086f521_arm64.deb

apt-get install ./ai-agent-vision_0.1.0.ci20250602172918.086f521_arm64.deb
```

# Application location

The application is installed under /opt/ai-agent-vision, with the following folders:

- conf: location of the env file that contains the configuration keys and values for the application
- data: location of the Mongo data files; mounted as a volume into the Mongo container
- uploads: location of all file uploads; mounted as a volume into the backend container, can be configured in the env file but that's not recommended
- backup: location of Mongo backups created by the mongo-backup container, which run every day at 2am

# Services

The appication is deployed as a system service so that it's automatically started and stopped together with the system. The service file is under `/etc/systemd/system/ai-agent-vision.service`, and can be operated as follows:

```bash
# reload the system service if changes are made
sudo systemctl daemon-reload

# enable the service (use "disable" for the opposite effect)
sudo systemctl enable ai-agent-vision

# start the service (or stop)
sudo systemctl start ai-agent-vision
```

# Backups

## Generating backups

Backups run once a day at 2:00 am, triggered by the `backup-mongo`container. Backups are stored under
`/opt/ai-agent-vision/backups` folder, and are generated by `mongodump`.

## Manually triggering backups

Backups can also be manually triggered, e.g., prior to deploying a new release:

```
cd /opt/ai-agent-service
docker-compose -f docker-compose.release.yml exec mongo-backup /usr/local/bin/backup-mongo.sh
```

The output should be something like this:

```
[backup-mongo] Sourcing environment variables from /app/.env
[backup-mongo] Starting backup to /backup/2025-06-07_19-56-05
[backup-mongo] Using MONGODB_URI: mongodb://mongo:27017
2025-06-07T19:56:05.605+0000	writing admin.system.version to /backup/2025-06-07_19-56-05/admin/system.version.bson
2025-06-07T19:56:05.606+0000	done dumping admin.system.version (1 document)
2025-06-07T19:56:05.606+0000	writing receipts.recipes to /backup/2025-06-07_19-56-05/receipts/recipes.bson
2025-06-07T19:56:05.607+0000	done dumping receipts.recipes (9 documents)
[backup-mongo] Backup completed at Sat Jun  7 19:56:05 UTC 2025

```

## Restoring backups

In progress.
